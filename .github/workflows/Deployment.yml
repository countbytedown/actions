name: Handle Deployment Request

on:
  issues:
    types: [opened, edited]

jobs:
  deploy:
    if: ${{ contains(join(github.event.issue.labels.*.name, ','), 'Deployment Request') }}
    runs-on: ubuntu-latest
    steps:
        - name: Checkout code
          uses: actions/checkout@v2
        # - name: Extract Environment from Issue
        #   id: get-environment
        #   run: |
        #     ENVIRONMENT=$(echo '${{ github.event.issue.body }}' | grep -oP 'Target Deployment Environment:\s*\K.*')
        #     echo "Extracted environment: $ENVIRONMENT"
        #     echo "::set-output name=environment::$ENVIRONMENT"

        - name: Dump GitHub context
          env:
            GITHUB_CONTEXT: ${{ toJson(github.event.issue.body ) }}
          run: |
            echo "$GITHUB_CONTEXT" | jq .
